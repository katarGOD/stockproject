(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2c477120"],{ae92:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},i=[];o._withStripped=!0;n("ac6a");var a={data:function(){return{postingCategoryOptions:[]}},created:function(){var t=this;t.$database.collection("postingCategory").orderBy("index").get().then(function(e){e.forEach(function(e){t.postingCategoryOptions.push({id:e.id,data:e.data(),type:e.data().type,value:e.id,label:"".concat(e.data().code)})})})}},r=a,s=n("2877"),l=Object(s["a"])(r,o,i,!1,null,null,null);l.options.__file="postingCategoryOptions.vue";e["a"]=l.exports},e80a:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",[n("q-table",{attrs:{"row-key":".key",selection:"single",data:t.deductionTb,columns:t.columns,filter:t.filter,loading:t.loading,pagination:t.pagination,selected:t.selected,"visible-columns":t.visibleColumns},on:{"update:pagination":function(e){t.pagination=e},"update:selected":function(e){t.selected=e}},scopedSlots:t._u([{key:"top-selection",fn:function(e){return[n("div",{staticStyle:{"padding-top":"8px","padding-bottom":"8px"}},[1==t.selected.length?n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"primary",round:"",icon:"edit",disable:!t.hasPermission(["personnel--employee-management--update"])},on:{click:function(e){t.openUpdateFrom(t.inputForm,t.selected[0])}}}):t._e(),n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"negative",icon:"delete",round:"",disable:!t.hasPermission(["personnel--employee-management--update"])},on:{click:function(e){t.deleteRow()}}})],1)]}},{key:"top-left",fn:function(e){return[n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"secondary",icon:"add_circle",round:"",disable:!t.hasPermission(["personnel--employee-management--update"])},on:{click:function(e){t.openAddForm(t.inputForm)}}}),n("q-search",{attrs:{"hide-underline":"",color:"secondary"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})]}},{key:"top-right",fn:function(e){return[n("q-table-columns",{staticClass:"q-mr-sm",attrs:{color:"secondary",columns:t.columns},model:{value:t.visibleColumns,callback:function(e){t.visibleColumns=e},expression:"visibleColumns"}})]}},{key:"body-cell-accountCode",fn:function(e){return n("q-td",{attrs:{props:e}},[n("q-btn",{attrs:{flat:"",label:t.accountCodeLabel(e.value)},on:{click:function(n){t.selected=[t._.find(t.deductionTb,{".key":e.row[".key"]})],t.openUpdateFrom(t.inputForm,t.selected[0])}}})],1)}},{key:"body-cell-calculateTax",fn:function(e){return n("q-td",{attrs:{props:e}},[n("span",{attrs:{small:"",color:"secondary"}},[e.value?n("q-icon",{attrs:{name:"done"}}):t._e(),e.value?t._e():n("q-icon",{attrs:{name:"clear"}})],1)])}},{key:"body-cell-postingCategory",fn:function(e){return n("q-td",{attrs:{props:e}},[n("span",{attrs:{small:"",color:"secondary"}},[t._v("\n      "+t._s(t.showPostingCategoryOption(e.value))+"\n      ")])])}},{key:"body-cell-amount",fn:function(e){return n("q-td",{staticStyle:{align:"right"},attrs:{props:e}},[t._v("\n      "+t._s(parseInt(e.value).toLocaleString(void 0,{minimumFractionDigits:2})+" THB")+"\n    ")])}}])}),n("q-modal",{attrs:{maximized:"","content-css":{padding:"50px"}},model:{value:t.formModal,callback:function(e){t.formModal=e},expression:"formModal"}},[n("div",{staticClass:"row justify-center gutter-lg"},[n("div",{staticClass:"col-xl-4 col-lg-4 col-md-4 col-sm12 col-xs-12"},[n("div",{staticClass:"q-headline"},[t._v(t._s(t.$t(t.$changeCase.sentenceCase(t.$options.name))))]),n("div",{staticClass:"q-subheading"},[t._v(t._s(t.subHeading))])]),n("div",{staticClass:"col-xl-8 col-lg-8 col-md-8 col-sm12 col-xs-12"},[n("q-field",{attrs:{label:t.$t("ID"),"label-width":t.labelWidth}},[n("q-input",{attrs:{disable:""},model:{value:t.inputForm[".key"],callback:function(e){t.$set(t.inputForm,".key",e)},expression:"inputForm['.key']"}})],1),n("q-field",{attrs:{label:t.$t("Account code")+" *","label-width":t.labelWidth,error:t.$v.inputForm.accountCode.$error,"error-label":t.$t("Requires non-empty data")}},[n("q-select",{attrs:{disable:!t.hasPermission(["personnel--employee-management--update"]),options:t.deductionAccountCodeOptions},on:{blur:function(e){t.$v.inputForm.accountCode.$touch()}},model:{value:t.inputForm.accountCode,callback:function(e){t.$set(t.inputForm,"accountCode",e)},expression:"inputForm.accountCode"}})],1),n("q-field",{attrs:{label:t.$t("Category")+" *","label-width":t.labelWidth}},[n("q-select",{attrs:{disable:"",options:t.postingCategoryOptions},model:{value:t.postingCategory,callback:function(e){t.postingCategory=e},expression:"postingCategory"}})],1),n("q-field",{attrs:{label:t.$t("Description"),"label-width":t.labelWidth}},[n("q-input",{attrs:{disable:!t.hasPermission(["personnel--employee-management--update"])},model:{value:t.inputForm.description,callback:function(e){t.$set(t.inputForm,"description",e)},expression:"inputForm.description"}})],1),n("q-field",{attrs:{label:t.$t("Quantity")+" *","label-width":t.labelWidth,error:t.$v.inputForm.quantity.$error,"error-label":t.$t("Requires non-empty data")}},[n("q-input",{attrs:{type:"number",disable:!t.hasPermission(["personnel--employee-management--update"])},on:{blur:function(e){t.$v.inputForm.quantity.$touch()}},model:{value:t.inputForm.quantity,callback:function(e){t.$set(t.inputForm,"quantity",e)},expression:"inputForm.quantity"}})],1),n("q-field",{attrs:{label:t.$t("Amount")+" *","label-width":t.labelWidth,error:t.$v.inputForm.amount.$error,"error-label":t.$t("Requires non-empty data")}},[n("q-input",{attrs:{type:"number",disable:!t.hasPermission(["personnel--employee-management--update"])},on:{blur:function(e){t.$v.inputForm.amount.$touch()}},model:{value:t.inputForm.amount,callback:function(e){t.$set(t.inputForm,"amount",e)},expression:"inputForm.amount"}})],1),n("q-field",{attrs:{label:t.$t("Total")+" *","label-width":t.labelWidth,error:t.$v.inputForm.total.$error,"error-label":t.$t("Requires non-empty data")}},[n("q-input",{attrs:{type:"number",disable:""},model:{value:t.inputForm.total,callback:function(e){t.$set(t.inputForm,"total",e)},expression:"inputForm.total"}})],1),n("q-field",{attrs:{"label-width":t.labelWidth,label:t.$t("Calculate tax")}},[n("q-toggle",{attrs:{disable:!t.hasPermission(["personnel--employee-management--update"])},model:{value:t.inputForm.calculateTax,callback:function(e){t.$set(t.inputForm,"calculateTax",e)},expression:"inputForm.calculateTax"}})],1),n("div",{staticClass:"submit"},["add"===t.formAction?n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"primary",icon:"save","wait-for-ripple":"",disable:t.$v.inputForm.$invalid,label:t.$t("save")},on:{click:t.addForm}}):t._e(),"update"===t.formAction?n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"primary",icon:"save","wait-for-ripple":"",disable:t.$v.inputForm.$invalid,label:t.$t("save")},on:{click:t.updateForm}}):t._e(),n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"light",icon:"cancel","wait-for-ripple":"",label:t.$t("Cancel")},on:{click:function(e){t.formModal=!1}}})],1)],1)])])],1)},i=[];o._withStripped=!0;var a=n("3156"),r=n.n(a),s=n("278c"),l=n.n(s),u=(n("ac6a"),n("551c"),n("7514"),n("96cf"),n("c973")),c=n.n(u),d=n("2f62"),p=n("b5ae"),m=n("7e05"),f=n("44de"),h=n("7266"),b=n("ae92"),g=n("05d8"),y=n("2ef0"),F=n.n(y),v={name:"deduction",mixins:[m["a"],f["a"],h["a"],b["a"],g["a"]],data:function(){return{subMenu:this.$t("Deduction"),deductionAccountCodeOptions:[],pagination:{sortBy:"accountCode",descending:!1},columns:[{name:".key",label:this.$t("ID"),field:".key",sortable:!0,align:"left"},{name:"accountCode",label:this.$t("Code"),field:"accountCode",sortable:!0,align:"left"},{name:"postingCategory",label:this.$t("Category"),field:"postingCategory",sortable:!0,align:"left"},{name:"description",label:this.$t("Description"),field:"description",sortable:!0,align:"left"},{name:"quantity",label:this.$t("Quantity"),field:"quantity",sortable:!1,align:"left"},{name:"amount",label:this.$t("Amount"),field:"amount",sortable:!1,align:"left"},{name:"total",label:this.$t("Total"),field:"total",sortable:!1,align:"left"}],visibleColumns:["accountCode","postingCategory","description","quantity","amount","total"],inputForm:{".key":null,accountCode:"",postingCategory:"",description:"",quantity:0,amount:0,total:0,calculateTax:!1,createdBy:this.userId,createdOn:new Date,modifiedBy:this.userId,modifiedOn:new Date,authUser:this.userId},postingCategory:""}},firestore:function(){return{deductionTb:this.$database.collection("deductionDetail").where("authUser","==",this.$route.params.id),deduction:this.$database.collection("deductionDetail")}},validations:{inputForm:{accountCode:{required:p["required"]},quantity:{required:p["required"],numeric:p["numeric"]},amount:{required:p["required"]},total:{required:p["required"],numeric:p["numeric"]}}},methods:{addForm:function(){var t=c()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this,e.inputForm.postingCategory=e.postingCategory,e.inputForm.createdBy=e.inputForm.modifiedBy=e.userId,e.inputForm.createdOn=e.inputForm.modifiedOn=new Date,e.inputForm.authUser=e.$route.params.id,t.next=7,e.addProcess(e.$firestore.deduction,e.inputForm,e.$v.inputForm);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),updateForm:function(){var t=c()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this,e.inputForm.postingCategory=e.postingCategory,e.inputForm.modifiedBy=e.userId,e.inputForm.modifiedOn=new Date,t.next=6,e.updateProcess(e.$firestore.deduction,e.inputForm,e.$v.inputForm);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),deleteRow:function(){var t=c()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this,t.next=3,e.deleteProcess(e.selected,e.$firestore.deduction);case 3:e.selected=[];case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),showPostingCategoryOption:function(t){var e=this,n="...";return e._.isUndefined(e._.find(e.postingCategoryOptions,{value:t}))||(n=F.a.find(e.postingCategoryOptions,{value:t})["label"]),n},accountCodeLabel:function(t){var e=this,n="...";return e._.isUndefined(e._.find(e.accountCodeOptions,{value:t}))||(n=e._.find(e.accountCodeOptions,{value:t})["label"]),n},getPostingCategory:function(t){var e=this;return new Promise(function(n){var o=e,i="";o.$database.collection("postingCategory").where("code","==",t).get().then(function(t){return t.forEach(function(t){i=t.id}),n(i)})})},getDeductionAccountCodeOptions:function(){var t=this;return new Promise(function(e){var n=t,o=[];n.$database.collection("accountCode").where("postingCategory","==",n.postingCategory).orderBy("code").get().then(function(t){return t.forEach(function(t){o.push({value:t.id,label:"".concat(t.data().code," : ").concat(t.data().description)})}),e(o)})})}},created:function(){var t=c()(regeneratorRuntime.mark(function t(){var e,n,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadingState(this.$firestore.deduction);case 2:return e=t.sent,n=l()(e,2),this.collectionSize=n[0],this.loading=n[1],o=this,o.$emit("updateSubMenu",o.subMenu),t.next=10,o.getPostingCategory("DEDUC");case 10:return o.postingCategory=t.sent,t.next=13,o.getDeductionAccountCodeOptions();case 13:o.deductionAccountCodeOptions=t.sent;case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),computed:r()({},Object(d["c"])(["userId"])),watch:{"inputForm.accountCode":function(){if(this.inputForm.accountCode){var t=this._.find(this.accountCodeOptions,{id:this.inputForm.accountCode});this._.isUndefined(t)||"add"===this.formAction&&(this.inputForm.description=t.data.description,this.inputForm.quantity=1,this.inputForm.amount=t.data.amount,this.inputForm.total=1*t.data.amount,this.inputForm.calculateTax=t.data.calculateTax)}else this.inputForm.description="",this.inputForm.quantity=0,this.inputForm.amount=0,this.inputForm.total=0,this.inputForm.calculateTax=!1},"inputForm.quantity":function(){this.inputForm.accountCode?this.inputForm.amount?this.inputForm.total=this.inputForm.quantity*this.inputForm.amount:(this.inputForm.amount=0,this.inputForm.total=0):(this.inputForm.description="",this.inputForm.quantity=0,this.inputForm.amount=0,this.inputForm.total=0,this.inputForm.calculateTax=!1)},"inputForm.amount":function(){this.inputForm.accountCode?this.inputForm.quantity?this.inputForm.total=this.inputForm.quantity*this.inputForm.amount:(this.inputForm.amount=0,this.inputForm.total=0):(this.inputForm.description="",this.inputForm.quantity=0,this.inputForm.amount=0,this.inputForm.total=0,this.inputForm.calculateTax=!1)}}},C=v,q=n("2877"),$=Object(q["a"])(C,o,i,!1,null,null,null);$.options.__file="deduction.vue";e["default"]=$.exports}}]);